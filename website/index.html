<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="refresh" content="10">
    <title>Portail</title>
    <style>
        body {
            background-color: whitesmoke;
            width: fit-content;
            padding: 15px;
            margin: auto;
            font-family: Arial, Helvetica, sans-serif;
        }
        div {
            border-style: solid;
            padding: 10px;
        }
        .btn {
            margin: 2px;
            padding: 5px;
            font-size: 15px;
        }
        h2{ margin: 0px; }
        h3{ margin: 0; }
        .cGris{ background-color: rgb(221, 219, 219); }
        .cRouge{ background-color: crimson; }
        .cVert{ background-color: green; }
        .cBleu{ background-color: darkblue; }
        .miniBox{ padding: 1px 20px; }
    </style>
</head>
<body>
    <div>
        <a href="/debug">Debug</a>
        <a href="/update">Update</a>
        <a href="/historique">Historique</a>
        <table>
            <tbody>
                <tr>
                    <td><h2>Infos:</h2></td>
                </tr>
                <tr>
                    <td>Date</td>
                    <td>%DATE%</td>
                </tr>
                <tr>
                    <td>Heure:</td>
                    <td>%HEURE%</td>
                </tr>
                <tr>
                    <td><b>Cycle en cours:</b></td>
                    <td><a class="miniBox %CYCLE%"></a></td>
                </tr>
                <tr>
                    <td><b>Ouverture Forcée:</b></td>
                    <td><a class="miniBox %FORCE%"></a></td>
                </tr>
                <tr>
                    <td>Presence du secteur:</td>
                    <td>%PRESENCE_SECTEUR%</td>
                </tr>
                <tr>
                    <td>Tension Batterie:</td>
                    <td>%VBAT%</td>
                </tr>
                <tr>
                    <td>Derniere coupure secteur:</td>
                    <td>%DATE_COUPURE%</td>
                </tr>
                <tr>
                    <td>Derniere presence secteur:</td>
                    <td>%DATE_PRESENCE%</td>
                </tr>
                <tr>
                    <td>Dernier cycle Jour:</td>
                    <td>%DATE_CYCLE_JOUR%</td>
                </tr>
                <tr>
                    <td>Dernier cycle Nuit:</td>
                    <td>%DATE_CYCLE_NUIT%</td>
                </tr>
            </tbody>
        </table>
    </div>
    <br>
    <div>
        <h2>Controles</h2>
            <form>
                <label>Heure d'hiver: </label>
                <input class="btn" id="heure_hiver" type="checkbox" onChange='sendGetRequest("heure_hiver")' %HEURE_HIVER%><br>
                <label>Synchroniser l'heure interne avec internet: </label>
                <input class="btn" type="button" value="Sync" onclick='sendGetRequest("sync_rtc")'><br>
                <label class="cInfo"><b>Ouverture forcée :</b></label>
                <input class="btn" type="button" value="On/Off" onclick='sendGetRequest("force")'><br>
                <label class="cInfo"><b>Ouverture normale: </b></label>
                <input class="btn" type="button" value="Valider" onclick='sendGetRequest("ouvre")'><br>
            </form>
        <h2>Plage Horaire Jour</h2>
            <form>
                <label>Debut: </label>
                <input id="horaireMatin" type="time" value="%PLAGE_MATIN%" onChange='sendGetRequest("horaireMatin")'>
                <label>Fin: </label>
                <input id="horaireNuit" type="time" value="%PLAGE_NUIT%" onChange='sendGetRequest("horaireNuit")'><br>
            </form>
        <h2>Ouverture forcée</h2>
        <table>
            <tbody>
                <tr>
                    <td>Derniere ouverture forcée: <span>%DATE_FORCE%</span></td>
                </tr>
                <tr>
                    <td>Compteur avant ouverture forcée: <span>%CMP_AVANT_FORCE%</span>/<span>%SEUIL_AVANT_FORCE%</span></td>
                </tr>
                <tr>
                    <td>
                        <input class="btn" type="button" value="Reset Compteur" onclick='sendGetRequest("avantForce_rst")'>
                        <input class="btn" type="button" value="Seuil -1" onclick='sendGetRequest("avantForce_moin")'>
                        <input class="btn" type="button" value="Seuil +1" onclick='sendGetRequest("avantForce_plus")'>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <br>
    <div>
        <h2>Compteurs (d'ouvertures)</h2>
        <table>
            <tbody>
                <tr>
                    <td><h3>Journalier: </h3></td>
                    <td>Jour:</td>
                    <td>%CMP_JOURNALIER_JOUR%</td>
                    <td><pre>    </pre></td>
                    <td>Nuit:</td>
                    <td>%CMP_JOURNALIER_NUIT%</td>
                </tr>

                <tr>
                    <td><h3>Principal: </h3></td>
                    <td>Jour:</td>
                    <td>%CMP_OUVERTURES_JOUR%</td>
                    <td></td>
                    <td>Nuit:</td>
                    <td>%CMP_OUVERTURES_NUIT%</td>
                    <td><pre>    </pre></td>
                    <td><input class="btn" type="button" value="Reset" onclick='sendGetRequest("cmp_principal_rst")'></td>
                </tr>

                <tr>
                    <td><h3>Auxiliaire: </h3></td>
                    <td>Jour:</td>
                    <td>%CMP_AUX_JOUR%</td>
                    <td></td>
                    <td>Nuit:</td>
                    <td>%CMP_AUX_NUIT%</td>
                    <td></td>
                    <td><input class="btn" type="button" value="Reset" onclick='sendGetRequest("cmp_aux_rst")'></td>
                </tr>

                <tr>
                    <td><h3>Coupures secteur:</h3></td>
                    <td><span>%CMP_COUPURES%</span></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><input class="btn" type="button" value="Reset" onclick='sendGetRequest("cmp_coupures_rst")'></td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
<br>
<script>
    function sendGetRequest(name) {
        var currentUrl = window.location.href;
        switch(name){
            // Controle
            case "heure_hiver":
                currentUrl += "?heure_hiver=" + document.getElementById(name).checked;
                break;

            case "sync_rtc":
                currentUrl += "?sync_rtc=" + Math.floor(Date.now() / 1000);
                break;

            //Plage horaire
            case "horaireMatin":
                var val = document.getElementById(name).value;
                currentUrl += "?horaireMatin&h="+ (val[0]+val[1]) +"&m=" + (val[3]+val[4]);
                break;
           
            case "horaireNuit":
                var val = document.getElementById(name).value;
                currentUrl += "?horaireNuit&h="+ (val[0]+val[1]) +"&m=" + (val[3]+val[4]);
                break;

            // Ouverture forcée
            case "avantForce_rst":
                currentUrl += "?avantForce_rst=0";
                break;

            // Compteurs
            case "cmp_principal_rst":
                currentUrl += "?cmp_principal_rst&jour=0&nuit=0";
                break;

            case "cmp_aux_rst":
                currentUrl += "?cmp_aux_rst&jour=0&nuit=0";
                break;

            case "cmp_coupures_rst":
                currentUrl += "?cmp_coupures_rst=0";
                break;

            default:
                currentUrl += "?" + name;
                break;
        }
        console.log(currentUrl);
        fetch(currentUrl)
        .then(response => {
            location.reload()
        })
        .catch(error => {
            console.log(error);
        });
    }
</script>
</html>